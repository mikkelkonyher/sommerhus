# Flutter App Conversion Prompt: Skovkrogen - Family Summer House Booking System

## PROJECT OVERVIEW

Build a Flutter mobile app called "Skovkrogen" - a private family booking system for a shared summer house located in Haarby, Denmark (coordinates: 55.22°N, 10.05°E). The app is used exclusively by family members to book and manage stays at the vacation home.

### Key Features:
- User authentication (login/logout, password reset)
- Interactive booking calendar with month/year views
- Create, view, edit, and delete bookings
- Weather forecast for the house location
- House information page (WiFi passwords, alarm codes, etc.)
- Checkout checklist for leaving the house
- Export bookings to Google Calendar / iCal
- Color-coded bookings by family member

### Target Users:
Six family members: Kurt, Beth, Katrine, Stefan, Mina, and Mikkel

### Language:
Danish (all UI text is in Danish)

---

## BACKEND: SUPABASE SETUP

### Supabase Configuration
The app uses Supabase as the backend. You need to set up:

**Environment Variables:**
```
SUPABASE_URL=<your-supabase-project-url>
SUPABASE_ANON_KEY=<your-supabase-anon-key>
```

### Authentication
Use Supabase Auth with email/password authentication.

**Auth Features:**
- Sign in with email and password
- Password reset via email (sends a reset link)
- Session management (auto-refresh tokens)
- Protected routes (all features require authentication)

---

## DATABASE SCHEMA

### Table: `bookings`

```sql
CREATE TABLE bookings (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
  start_date DATE NOT NULL,
  end_date DATE NOT NULL,
  guest_name TEXT NOT NULL,           -- One of: Kurt, Beth, Katrine, Stefan, Mina, Mikkel
  guest_email TEXT NOT NULL,          -- The authenticated user's email
  guest_count INTEGER DEFAULT 1,       -- Number of guests (1-20)
  allow_other_family BOOLEAN DEFAULT FALSE,  -- If true, other family members can also use the house
  purpose TEXT,                        -- Optional: reason for the booking
  status TEXT DEFAULT 'confirmed',     -- Status: 'confirmed', 'cancelled', 'pending'
  checkout_checklist JSONB DEFAULT '{
    "empty_trash": false,
    "lock_doors": false,
    "turn_on_alarm": false,
    "close_windows": false,
    "turn_off_heat": false,
    "clean_kitchen": false
  }'::jsonb
);
```

**Row Level Security (RLS):**
- All authenticated users can SELECT all bookings
- All authenticated users can INSERT bookings (with their own email)
- Users can only UPDATE/DELETE bookings where guest_email matches their email

### Table: `house_info`

```sql
CREATE TABLE house_info (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
  title TEXT NOT NULL,          -- e.g., "Wifi Navn", "Wifi Kode", "Nøgleboks"
  value TEXT NOT NULL,          -- The actual secret value
  category TEXT DEFAULT 'Generelt',  -- e.g., "Internet", "Adgang", "Praktisk"
  icon TEXT                     -- Optional: icon name (e.g., "Wifi", "Key", "Lock")
);
```

**Row Level Security (RLS):**
- Only authenticated users can read house_info
- Write access for authenticated users (or restrict to admins)

---

## API ENDPOINTS (SUPABASE CLIENT)

### Bookings CRUD Operations

**Fetch all bookings:**
```dart
final response = await supabase
    .from('bookings')
    .select('*');
```

**Create a booking:**
```dart
await supabase.from('bookings').insert({
  'start_date': '2024-06-15',  // Format: YYYY-MM-DD
  'end_date': '2024-06-20',
  'guest_name': 'Mikkel',
  'guest_email': currentUser.email,
  'guest_count': 4,
  'allow_other_family': false,
  'purpose': 'Sommerferie',
  'status': 'confirmed'
});
```

**Update a booking:**
```dart
await supabase.from('bookings').update({
  'guest_name': 'Mikkel',
  'start_date': '2024-06-16',
  'end_date': '2024-06-21',
  'guest_count': 5,
  'purpose': 'Forlænget ferie'
}).eq('id', bookingId);
```

**Delete a booking:**
```dart
await supabase.from('bookings').delete().eq('id', bookingId);
```

**Update checkout checklist:**
```dart
await supabase.from('bookings').update({
  'checkout_checklist': {
    'empty_trash': true,
    'lock_doors': true,
    'turn_on_alarm': false,
    'close_windows': true,
    'turn_off_heat': true,
    'clean_kitchen': false
  }
}).eq('id', bookingId);
```

### House Info Operations

**Fetch all house info:**
```dart
final response = await supabase
    .from('house_info')
    .select('*')
    .order('category', ascending: true)
    .order('title', ascending: true);
```

### Authentication Operations

**Sign in:**
```dart
final response = await supabase.auth.signInWithPassword(
  email: email,
  password: password,
);
```

**Sign out:**
```dart
await supabase.auth.signOut();
```

**Get current user:**
```dart
final user = supabase.auth.currentUser;
```

**Password reset request:**
```dart
await supabase.auth.resetPasswordForEmail(
  email,
  redirectTo: 'your-app://reset-password',
);
```

**Update password (after clicking reset link):**
```dart
await supabase.auth.updateUser(
  UserAttributes(password: newPassword),
);
```

---

## EXTERNAL API: WEATHER FORECAST

### Open-Meteo API (Free, no API key required)

**Endpoint:**
```
https://api.open-meteo.com/v1/forecast?latitude=55.22&longitude=10.05&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max,wind_speed_10m_max&timezone=Europe%2FCopenhagen
```

**Response Structure:**
```json
{
  "daily": {
    "time": ["2024-01-23", "2024-01-24", ...],  // Array of dates (7 days)
    "weather_code": [0, 3, 61, ...],             // WMO weather codes
    "temperature_2m_max": [5.2, 6.1, ...],       // Max temperature in °C
    "temperature_2m_min": [1.2, 2.3, ...],       // Min temperature in °C
    "precipitation_sum": [0.0, 2.5, ...],        // Precipitation in mm
    "precipitation_probability_max": [10, 80, ...], // Probability %
    "wind_speed_10m_max": [15.2, 22.5, ...]      // Wind speed km/h
  }
}
```

**WMO Weather Codes Mapping:**
```dart
Map<int, WeatherInfo> weatherCodes = {
  0: WeatherInfo('Klart vejr', Icons.wb_sunny, Colors.yellow),
  1: WeatherInfo('Hovedsageligt klart', Icons.wb_sunny, Colors.yellow),
  2: WeatherInfo('Delvist skyet', Icons.cloud_queue, Colors.grey),
  3: WeatherInfo('Overskyet', Icons.cloud, Colors.grey),
  45: WeatherInfo('Tåge', Icons.foggy, Colors.grey),
  48: WeatherInfo('Rimtåge', Icons.foggy, Colors.grey),
  51: WeatherInfo('Let støvregn', Icons.grain, Colors.blue),
  53: WeatherInfo('Moderat støvregn', Icons.grain, Colors.blue),
  55: WeatherInfo('Tæt støvregn', Icons.grain, Colors.blue),
  61: WeatherInfo('Let regn', Icons.water_drop, Colors.blue),
  63: WeatherInfo('Moderat regn', Icons.water_drop, Colors.blue),
  65: WeatherInfo('Kraftig regn', Icons.water_drop, Colors.blue),
  71: WeatherInfo('Let sne', Icons.ac_unit, Colors.lightBlue),
  73: WeatherInfo('Moderat sne', Icons.ac_unit, Colors.lightBlue),
  75: WeatherInfo('Kraftig sne', Icons.ac_unit, Colors.lightBlue),
  80: WeatherInfo('Lette byger', Icons.water_drop, Colors.blue),
  81: WeatherInfo('Moderate byger', Icons.water_drop, Colors.blue),
  82: WeatherInfo('Kraftige byger', Icons.water_drop, Colors.blue),
  95: WeatherInfo('Tordenvejr', Icons.bolt, Colors.purple),
  96: WeatherInfo('Tordenvejr med hagl', Icons.bolt, Colors.purple),
  99: WeatherInfo('Tordenvejr med kraftig hagl', Icons.bolt, Colors.purple),
};
```

---

## UI/SCREENS STRUCTURE

### 1. Login Screen (`/login`)
- App logo (tree icon)
- App name: "Skovkrogen"
- Email input field
- Password input field
- "Log ind" button
- "Glemt adgangskode?" link

### 2. Reset Password Screen (`/reset-password`)
Two states:
1. **Request Reset:** Email input, "Send nulstillingslink" button
2. **Set New Password:** New password input, confirm password input, "Nulstil adgangskode" button

### 3. Dashboard/Home Screen (`/`)
**Header:**
- App name and tree icon (tap to go home)
- "Info om huset" navigation link
- Logout button

**Main Content (scrollable):**
1. **Weather Forecast Card** - 7-day forecast with icons
2. **Calendar Card** - Interactive calendar with bookings
3. **Booking Form Card** - Form to create new bookings
4. **Bookings List Card** - List of upcoming bookings

### 4. House Info Screen (`/info`)
- Same header as dashboard
- List of info items grouped by category
- Each item shows: icon, title, hidden value (tap to reveal)
- Copy button for each value
- Back button to dashboard

---

## DETAILED COMPONENT SPECIFICATIONS

### Weather Forecast Component
- Show 7-day forecast in a horizontal scrollable row
- Each day shows:
  - Day name ("I dag", "I morgen", "Man", "Tir", etc.)
  - Date (e.g., "23. jan")
  - Weather icon (based on weather code)
  - Weather description
  - Temperature range (max°/min°)
  - Precipitation probability with droplet icon
- Below the row: Today's detailed info (temperature range, precipitation amount, wind speed)

### Calendar Component
**Two View Modes:**
1. **Month View:**
   - Standard calendar grid
   - Swipe/arrow buttons to navigate months
   - Dropdown to jump to specific month/year
   
2. **Year View:**
   - 12 mini-calendars in a grid (4 columns x 3 rows on tablet, 3 columns on phone)
   - Arrow buttons to navigate years

**Calendar Features:**
- Past dates are grayed out and not selectable
- Booked dates are color-coded by person (see color mapping below)
- Tap on a booked date to view booking details
- Select date range by tapping start date, then end date
- Selected range is highlighted in blue

**Color Mapping for Family Members:**
```dart
Map<String, Color> personColors = {
  'Kurt': Color(0xFF3B82F6),     // Blue
  'Beth': Color(0xFFEC4899),     // Pink
  'Katrine': Color(0xFF8B5CF6),  // Purple
  'Stefan': Color(0xFF10B981),   // Green
  'Mina': Color(0xFFF59E0B),     // Orange
  'Mikkel': Color(0xFF06B6D4),   // Cyan
};
```

### Booking Form Component
**Fields:**
1. **Name** (dropdown): Kurt, Beth, Katrine, Stefan, Mina, Mikkel
2. **Guest Count** (dropdown): 1-20
3. **Shared Booking** (checkbox): "Delt" - with subtitle "Andre kan også bruge huset i denne periode"
4. **Purpose** (optional textarea): Placeholder "f.eks. reparation af vandskade"

**Submit Button:** "Book nu" (disabled if no date selected)
**Validation:** Date range must be selected before submitting

**Success State:**
- Shows success icon and "Booking bekræftet!"
- "Tilføj til Google Kalender" button
- "Tilføj til iCal" button  
- "Luk" button to dismiss

### Booking List Component
**Filter Section:**
- Toggle to show/hide filters
- Filter by email (text search)
- Filter by start date
- Filter by end date
- Filter "Kun delte bookinger" (shared only)
- "Ryd filtre" button

**Booking Item:**
Each booking shows:
- Status icon (checkmark for confirmed, X for cancelled)
- Guest name
- Date range: "15. jun - 20. jun 2024"
- Guest count if > 1
- "Delt" badge if allow_other_family is true
- Purpose if provided
- Created date and email
- Booking ID badge (#123)

**Actions (per booking):**
- Calendar icon: View details and add to calendar
- Checklist icon: Open checkout checklist
- Edit icon: Edit booking (only if user is owner)
- Delete icon: Delete booking (only if user is owner)

### Booking Info Modal
Shows when tapping a booked date or calendar icon:
- Period (start - end dates in full format)
- Booked by (guest name)
- Number of guests
- Allow other family (yes/no with icon)
- Purpose (if provided)
- "Tilføj til Google Kalender" button
- "Tilføj til iCal" button
- "Luk" button

### Checkout Checklist Modal
**Progress Bar:** Shows X/6 completed tasks

**Checklist Items (with checkboxes):**
1. Tøm skrald (Empty trash)
2. Lås døre (Lock doors)
3. Tænd alarm (Turn on alarm)
4. Luk vinduer (Close windows)
5. Sluk varme (Turn off heat)
6. Rengør køkken (Clean kitchen)

**Features:**
- Tap item to toggle completion
- Auto-saves to database on change
- Success message when all complete: "Alle opgaver er fuldført!"
- "Luk" button

### Delete Confirmation Modal
- Warning icon
- Title: "Slet booking"
- Message: "Er du sikker på at du vil slette denne booking? Denne handling kan ikke fortrydes."
- "Slet" button (red/danger style)
- "Annuller" button

### House Info Screen
**Grouped by Category:**
Each group has a header with category name, then list of items.

**Each Item Shows:**
- Icon (Wifi, Key, or Info icon)
- Title (e.g., "Wifi Navn", "Wifi Kode")
- Value (hidden by default, shows "••••••••", tap to reveal)
- Copy button (shows checkmark briefly after copying)

---

## CALENDAR EXPORT FUNCTIONALITY

### Google Calendar Export
Generate URL and open in browser/Google Calendar app:
```dart
String generateGoogleCalendarUrl(Booking booking) {
  // Format dates as YYYYMMDD
  String startDate = DateFormat('yyyyMMdd').format(booking.startDate);
  // End date is exclusive in Google Calendar, add 1 day
  String endDate = DateFormat('yyyyMMdd').format(
    booking.endDate.add(Duration(days: 1))
  );
  
  String title = Uri.encodeComponent('Sommerhus: ${booking.guestName}');
  String details = Uri.encodeComponent('Booking af sommerhus.');
  
  return 'https://calendar.google.com/calendar/render?action=TEMPLATE&text=$title&dates=$startDate/$endDate&details=$details';
}
```

### iCal Export
Generate .ics file and share:
```dart
String generateICalContent(Booking booking) {
  String startDate = DateFormat('yyyyMMdd').format(booking.startDate);
  String endDate = DateFormat('yyyyMMdd').format(
    booking.endDate.add(Duration(days: 1))
  );
  String timestamp = DateFormat("yyyyMMdd'T'HHmmss'Z'").format(DateTime.now().toUtc());
  
  return '''BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Sommerhus Booking//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
DTSTART;VALUE=DATE:$startDate
DTEND;VALUE=DATE:$endDate
DTSTAMP:$timestamp
SUMMARY:Sommerhus: ${booking.guestName}
DESCRIPTION:Booking af sommerhus.
STATUS:CONFIRMED
SEQUENCE:0
END:VEVENT
END:VCALENDAR''';
}
```

---

## DANISH TEXT TRANSLATIONS

### Navigation & Headers
- "Skovkrogen" - App name
- "Kalender" - Calendar
- "Ny booking" - New booking
- "Bookinger" - Bookings
- "Info om huset" - House info
- "Vejrudsigt" - Weather forecast
- "Vejrudsigt for Skovkrogen" - Weather forecast for Skovkrogen
- "Log ud" - Log out

### Calendar
- "Måned" - Month
- "År" - Year
- "I dag" - Today
- "I morgen" - Tomorrow
- "Vælg dato" - Select date
- Days: "Søn", "Man", "Tir", "Ons", "Tor", "Fre", "Lør"
- Months: "januar", "februar", "marts", "april", "maj", "juni", "juli", "august", "september", "oktober", "november", "december"

### Booking Form
- "Navn" - Name
- "Vælg navn..." - Choose name...
- "Antal personer" - Number of guests
- "Delt" - Shared
- "Andre kan også bruge huset i denne periode" - Others can also use the house during this period
- "Formål (valgfrit)" - Purpose (optional)
- "Book nu" - Book now
- "Booker..." - Booking...
- "Vælg dato i kalenderen for at booke." - Select a date in the calendar to book.

### Booking Success
- "Booking bekræftet!" - Booking confirmed!
- "Din booking er registreret." - Your booking is registered.
- "Tilføj til Google Kalender" - Add to Google Calendar
- "Tilføj til iCal" - Add to iCal
- "Luk" - Close

### Booking List
- "Filtrer bookinger" - Filter bookings
- "Ryd filtre" - Clear filters
- "Email" - Email
- "Søg efter email..." - Search by email...
- "Fra dato" - From date
- "Til dato" - To date
- "Kun delte bookinger" - Shared bookings only
- "Viser X booking(er)" - Showing X booking(s)
- "Ingen kommende bookinger." - No upcoming bookings.
- "Ingen bookinger matcher dine filtre." - No bookings match your filters.
- "bookede" - booked
- "personer" - people
- "Oprettet" - Created
- "Formål:" - Purpose:

### Booking Actions
- "Se detaljer og tilføj til kalender" - View details and add to calendar
- "Tjekliste" - Checklist
- "Rediger" - Edit
- "Slet booking" - Delete booking
- "Gem" - Save
- "Annuller" - Cancel

### Booking Info Modal
- "Booking Information" - Booking Information
- "Periode" - Period
- "Booket af" - Booked by
- "Antal personer" - Number of guests
- "Tillad andre familiemedlemmer" - Allow other family members
- "Ja" / "Nej" - Yes / No

### Checkout Checklist
- "Tjekliste ved afrejse" - Checkout checklist
- "Fremskridt" - Progress
- "Tøm skrald" - Empty trash
- "Lås døre" - Lock doors
- "Tænd alarm" - Turn on alarm
- "Luk vinduer" - Close windows
- "Sluk varme" - Turn off heat
- "Rengør køkken" - Clean kitchen
- "Alle opgaver er fuldført!" - All tasks completed!
- "Gemmer..." - Saving...

### Delete Confirmation
- "Slet booking" - Delete booking
- "Er du sikker på at du vil slette denne booking? Denne handling kan ikke fortrydes." - Are you sure you want to delete this booking? This action cannot be undone.
- "Slet" - Delete
- "Annuller" - Cancel

### Login
- "Log ind for at booke sommerhuset" - Log in to book the summer house
- "Email" - Email
- "Adgangskode" - Password
- "Log ind" - Log in
- "Logger ind..." - Logging in...
- "Glemt adgangskode?" - Forgot password?

### Reset Password
- "Glemt adgangskode?" - Forgot password?
- "Indtast din email, og vi sender dig et link til at nulstille din adgangskode" - Enter your email and we'll send you a link to reset your password
- "Send nulstillingslink" - Send reset link
- "Sender..." - Sending...
- "Vi har sendt et link til din email..." - We've sent a link to your email...
- "Nulstil adgangskode" - Reset password
- "Indtast din nye adgangskode" - Enter your new password
- "Ny adgangskode" - New password
- "Bekræft adgangskode" - Confirm password
- "Nulstiller..." - Resetting...
- "Adgangskoderne matcher ikke" - Passwords don't match
- "Adgangskoden skal være mindst 6 tegn lang" - Password must be at least 6 characters
- "Tilbage til login" - Back to login

### House Info
- "Info om huset" - House info
- "Tilbage til oversigt" - Back to overview
- "Kunne ikke hente informationer." - Could not fetch information.
- "Der er ingen informationer tilgængelige endnu." - No information available yet.
- "Kopier" - Copy
- "Klik for at vise" - Click to reveal
- "Klik for at skjule" - Click to hide

### Weather
- "Haarby, Danmark" - Haarby, Denmark
- "Temperatur" - Temperature
- "Nedbør" - Precipitation
- "Vind" - Wind

### Errors
- "Der skete en fejl. Prøv igen senere." - An error occurred. Please try again later.
- "Vælg venligst en dato først." - Please select a date first.
- "Slut dato skal være efter start dato." - End date must be after start date.
- "De valgte datoer overlapper med en eksisterende booking." - The selected dates overlap with an existing booking.
- "Der skete en fejl ved sletning." - An error occurred while deleting.
- "Der skete en fejl ved opdatering." - An error occurred while updating.

---

## RECOMMENDED FLUTTER PACKAGES

```yaml
dependencies:
  flutter:
    sdk: flutter
  supabase_flutter: ^2.0.0          # Supabase client
  table_calendar: ^3.0.0            # Calendar widget
  intl: ^0.18.0                     # Date formatting
  http: ^1.0.0                      # Weather API calls
  url_launcher: ^6.0.0              # Open Google Calendar links
  share_plus: ^7.0.0                # Share iCal files
  path_provider: ^2.0.0             # Save iCal files
  flutter_secure_storage: ^9.0.0    # Store credentials securely
```

---

## APP FLOW SUMMARY

1. **Launch App** → Check if user is authenticated
2. **Not authenticated** → Show Login screen
3. **Authenticated** → Show Dashboard
4. **Dashboard** → Weather, Calendar, Booking Form, Booking List
5. **Create Booking** → Select dates on calendar → Fill form → Submit → Success with calendar export options
6. **View Booking** → Tap booked date or calendar icon → Modal with details
7. **Edit Booking** → Tap edit icon (own bookings only) → Inline edit form
8. **Delete Booking** → Tap delete icon (own bookings only) → Confirmation modal
9. **Checkout** → Tap checklist icon → Modal with toggleable checklist
10. **House Info** → Navigate via header → List of secret info with reveal/copy
11. **Logout** → Tap logout → Return to Login screen

---

## DESIGN NOTES

- Use a clean, modern design with subtle shadows and rounded corners
- Primary color: Blue (#0969da)
- Success color: Green (#10B981)
- Danger color: Red (#DC2626)
- Background: Light gray (#F6F8FA)
- Cards: White with subtle borders
- Use the tree icon (pine trees) as the app logo/branding
- Responsive design: Works on both phones and tablets
- Dark mode: Not required for initial version

---

## TESTING CONSIDERATIONS

1. Test booking overlap detection
2. Test date range selection across months
3. Test authentication flow and token refresh
4. Test offline behavior (show cached data, queue updates)
5. Test calendar export on iOS and Android
6. Test password reset flow with deep linking

---

## NOTES FOR FLUTTER IMPLEMENTATION

1. Use Riverpod or Provider for state management
2. Implement proper error handling and loading states
3. Cache bookings locally for offline viewing
4. Use deep links for password reset (your-app://reset-password)
5. Consider adding push notifications for booking reminders
6. The checkout checklist should auto-save on toggle (debounce recommended)
7. Calendar should default to current month on load
8. Filter only future bookings in the booking list (end_date >= today)
